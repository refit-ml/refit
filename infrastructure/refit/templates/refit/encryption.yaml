{{- if .Release.IsInstall }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-encryption-key
  labels:
    app: {{ .Release.Name }}
    meta.helm.sh/release-name: "{{ .Release.Name }}"
    meta.helm.sh/release-namespace: "{{ .Release.Namespace }}"
  annotations:
    meta.helm.sh/release-name: "{{ .Release.Name }}"
    meta.helm.sh/release-namespace: "{{ .Release.Namespace }}"
    "helm.sh/resource-policy": keep
type: Opaque
data:
  {{- if eq .Values.refit.encryptionKey "__generated__" }}
  password: "{{ randAlphaNum 30 | b64enc }}"
  {{- else }}
  password: "{{ .Values.refit.encryptionKey | b64enc }}"
  {{- end }}

---
apiVersion: v1
kind: Secret
metadata:
  name: refit-cassandra-credentials
  labels:
    app: {{ .Release.Name }}
    meta.helm.sh/release-name: "{{ .Release.Name }}"
    meta.helm.sh/release-namespace: "{{ .Release.Namespace }}"
  annotations:
    meta.helm.sh/release-name: "{{ .Release.Name }}"
    meta.helm.sh/release-namespace: "{{ .Release.Namespace }}"
    "helm.sh/resource-policy": keep
type: Opaque
data:
  {{- if eq .Values.refit.cassandraPassword "__generated__" }}
   cassandra-password: "{{ randAlphaNum 30 | b64enc }}"
  {{- else }}
   cassandra-password: "{{ .Values.refit.cassandraPassword | b64enc }}"
  {{- end }}
{{- end }}